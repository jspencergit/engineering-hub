<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Language" content="en">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Feedback Network Analyzer - Analog Engineering Hub</title>
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <!-- Link to CSS -->
    <link rel="stylesheet" href="styles.css">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <header>
        <h1>Analog Engineering Hub</h1>
        <p><a href="https://jspencergit.github.io/engineering-hub/tools.html">Back to Tools</a></p>
    </header>

    <section id="tools">
        <div class="calculator">
            <h3>Feedback Network Analyzer</h3>
            <img src="images/FeedbackNetworkDiagram.jpg" alt="Feedback Network Diagram" class="schematic">

            <!-- Plant Parameters -->
            <div class="param-group">
                <h4>Plant</h4>
                <label for="plant-gain">Gain (dB):</label>
                <input type="number" id="plant-gain" step="1" min="-100" value="0">
                <label for="plant-pole">Pole (kHz):</label>
                <input type="number" id="plant-pole" step="0.1" min="0.001" value="1">
                <label for="plant-zero">Zero (kHz):</label>
                <input type="number" id="plant-zero" step="0.1" min="0.001" value="0.1">
            </div>

            <!-- Compensator Parameters -->
            <div class="param-group-container">
                <div class="param-group">
                    <h4>Compensator</h4>
                    <!-- Low Frequency Gain Section -->
                    <div class="input-group">
                        <label for="comp-low-freq-gain">Low Frequency Gain (dB):</label>
                        <input type="number" id="comp-low-freq-gain" step="1" min="-100" max="100" value="60">
                    </div>
                    <div class="input-group">
                        <label for="comp-low-freq">at Frequency (Hz):</label>
                        <input type="number" id="comp-low-freq" step="1" min="1" max="10000" value="100">
                    </div>
                    <div class="input-group">
                        <label for="comp-pole">Pole (kHz):</label>
                        <input type="number" id="comp-pole" step="0.1" min="0.001" max="1000" value="100">
                    </div>
                    <div class="input-group">
                        <input type="range" id="comp-pole-slider" min="0.001" max="1000" step="0.1" value="100">
                    </div>
                    <div class="input-group">
                        <label for="comp-zero">Zero (kHz):</label>
                        <input type="number" id="comp-zero" step="0.1" min="0.001" max="1000" value="10">
                    </div>
                    <div class="input-group">
                        <input type="range" id="comp-zero-slider" min="0.001" max="1000" step="0.1" value="10">
                    </div>
                    <div class="transfer-function" id="comp-tf">\( C(s) = \frac{1}{s} \)</div>
                </div>
            </div>

            <!-- Feedback Parameters -->
            <div class="param-group-container">
                <div class="param-group">
                    <h4>Feedback</h4>
                    <div class="input-group">
                        <label for="fb-gain">Gain (dB):</label>
                        <input type="number" id="fb-gain" step="0.1" min="-20" max="20" value="-12.7">
                    </div>
                    <div class="input-group">
                        <input type="range" id="fb-gain-slider" min="-20" max="20" step="0.1" value="-12.7">
                    </div>
                    <div class="input-group checkbox-row">
                        <label><span class="checkbox-label">Enable Feedback Zero</span></label>
                        <input type="checkbox" id="fb-zero-check">
                        <label for="fb-zero">Zero (kHz):</label>
                        <input type="number" id="fb-zero" step="0.1" min="0.001" max="1000" value="10.8" disabled>
                        <input type="range" id="fb-zero-slider" min="1" max="100" step="0.1" value="10.8" disabled>
                    </div>
                    <div class="input-group checkbox-row">
                        <label><span class="checkbox-label">Enable Feedback Pole</span></label>
                        <input type="checkbox" id="fb-pole-check">
                        <label for="fb-pole">Pole (kHz):</label>
                        <input type="number" id="fb-pole" step="0.1" min="1" max="1000" value="155.7" disabled>
                        <input type="range" id="fb-pole-slider" min="1" max="1000" step="0.1" value="155.7" disabled>
                    </div>
                    <div class="transfer-function" id="fb-tf">\( F(s) = 1 \)</div>
                </div>
            </div>

            <!-- Closed-Loop Outputs -->
            <div class="param-group">
                <h4>Closed-Loop Results</h4>
                <div>Bandwidth: <span id="bw-output">0</span> kHz</div>
                <div>Phase Margin: <span id="pm-output">0</span>Â°</div>
            </div>

            <!-- Reset Button -->
            <div class="param-group" style="text-align: center; margin-top: 20px;">
                <button id="reset-button">Reset to Defaults</button>
            </div>
        </div>
        <div class="charts">
            <!-- Plant Plot -->
            <div class="chart-group">
                <div class="chart-header">
                    <h4>Plant Response</h4>
                </div>
                <canvas id="plant-bode-chart"></canvas>
            </div>

            <!-- Compensator Plot -->
            <div class="chart-group">
                <div class="chart-header">
                    <h4>Compensator Response</h4>
                    <div class="transfer-function" id="comp-tf-chart">\( C(s) = \frac{1}{s} \)</div>
                </div>
                <canvas id="comp-bode-chart"></canvas>
            </div>

            <!-- Feedback Plot -->
            <div class="chart-group">
                <div class="chart-header">
                    <h4>Feedback Response</h4>
                    <div class="transfer-function" id="fb-tf-chart">\( F(s) = 1 \)</div>
                </div>
                <canvas id="fb-bode-chart"></canvas>
            </div>

            <!-- Closed-Loop Plot -->
            <div class="chart-group">
                <div class="chart-header">
                    <h4>Closed-Loop Response</h4>
                </div>
                <canvas id="closed-bode-chart"></canvas>
            </div>
        </div>
    </section>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" defer></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)']]
            },
            chtml: {
                scale: 1.5
            },
            startup: {
                ready() {
                    MathJax.startup.defaultReady();
                    // Trigger initial typesetting after MathJax is ready
                    setTimeout(() => {
                        if (typeof MathJax !== "undefined" && MathJax.typeset) {
                            MathJax.typeset();
                        }
                    }, 1000); // Increased delay to 1000ms
                }
            }
        };
    </script>
    <script src="calculator.js"></script>
    <script src="charts.js"></script>
    <script src="events.js"></script>
</body>
</html>